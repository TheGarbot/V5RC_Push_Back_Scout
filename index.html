<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2563eb">
    <title>VEX Scout</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icon-192.png">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>VEX Scout</h1>
            <div class="match-counter">Matches Recorded: <span id="matchCount">0</span></div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('scout')">Scout</button>
            <button class="nav-tab" onclick="switchTab('data')">Data</button>
            <button class="nav-tab" onclick="switchTab('export')">Export</button>
        </div>

        <div id="scout-tab" class="tab-content active">
            <div class="install-banner" id="installBanner">
                ðŸ“± <strong>Add to Home Screen</strong> for the best experience!<br>
                <div class="install-steps">
                    iOS: Share button â†’ "Add to Home Screen"<br>
                    Android: Menu â†’ "Add to Home Screen"
                </div>
            </div>

            <form id="scoutForm">
                <div class="form-group">
                    <label for="matchNumber">Match Number <span class="required">*</span></label>
                    <input type="number" id="matchNumber" required min="1">
                </div>

                <div class="form-group">
                    <label for="teamNumber">Team Number <span class="required">*</span></label>
                    <input type="text" id="teamNumber" required placeholder="e.g., 9123X" pattern="[0-9]+[A-Z]?">
                    <div class="error-message" id="teamError" style="display: none;">Invalid team format (use format like 9123X)</div>
                </div>

                <div class="form-group">
                    <label>Autonomous Period</label>
                    
                    <label for="autoGoalRush">Goal Rush Bonus</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="autoGoalRush" value="yes"> Yes
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="autoGoalRush" value="no" checked> No
                        </label>
                    </div>

                    <label for="autoRingsScored">Rings Scored</label>
                    <div class="counter-group">
                        <button type="button" class="counter-btn" onclick="changeCounter('autoRingsScored', -1)">-</button>
                        <div class="counter-value" id="autoRingsScored">0</div>
                        <button type="button" class="counter-btn" onclick="changeCounter('autoRingsScored', 1)">+</button>
                    </div>

                    <label for="autoMogos">Mobile Goals Scored</label>
                    <div class="counter-group">
                        <button type="button" class="counter-btn" onclick="changeCounter('autoMogos', -1)">-</button>
                        <div class="counter-value" id="autoMogos">0</div>
                        <button type="button" class="counter-btn" onclick="changeCounter('autoMogos', 1)">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Driver Control Period</label>
                    
                    <label for="driverRingsScored">Rings Scored</label>
                    <div class="counter-group">
                        <button type="button" class="counter-btn" onclick="changeCounter('driverRingsScored', -1)">-</button>
                        <div class="counter-value" id="driverRingsScored">0</div>
                        <button type="button" class="counter-btn" onclick="changeCounter('driverRingsScored', 1)">+</button>
                    </div>

                    <label for="driverMogos">Mobile Goals Controlled</label>
                    <div class="counter-group">
                        <button type="button" class="counter-btn" onclick="changeCounter('driverMogos', -1)">-</button>
                        <div class="counter-value" id="driverMogos">0</div>
                        <button type="button" class="counter-btn" onclick="changeCounter('driverMogos', 1)">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="endgame">Endgame</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="endgame" value="none" checked> None
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="endgame" value="single"> Single
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="endgame" value="double"> Double
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="notes">Notes</label>
                    <textarea id="notes" placeholder="Qualitative observations..."></textarea>
                </div>

                <button type="submit" class="btn btn-primary">Save Match Data</button>
                <button type="button" class="btn btn-secondary" onclick="resetForm()">Clear Form</button>
            </form>
        </div>

        <div id="data-tab" class="tab-content">
            <h3>Recorded Matches</h3>
            <div id="matchList" class="match-list">
                <p style="text-align: center; color: #6b7280; padding: 20px;">No matches recorded yet</p>
            </div>
            <button class="btn btn-danger" onclick="clearAllData()">Clear All Data</button>
        </div>

        <div id="export-tab" class="tab-content">
            <div id="exportSuccess" style="display: none;"></div>
            
            <h3>Export Data</h3>
            <p style="margin-bottom: 20px; color: #6b7280;">Share your scouting data with your team</p>
            
            <button class="btn btn-primary" onclick="exportToEmail()">ðŸ“§ Email Export</button>
            <button class="btn btn-secondary" onclick="copyToClipboard()">ðŸ“‹ Copy to Clipboard</button>
            
            <div style="margin-top: 30px;">
                <h4>Data Summary</h4>
                <div id="dataSummary" style="background: #f8fafc; padding: 15px; border-radius: 8px; margin-top: 10px;">
                    <div>Total Matches: <span id="totalMatches">0</span></div>
                    <div>Last Updated: <span id="lastUpdated">Never</span></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let matches = JSON.parse(localStorage.getItem('vexScoutMatches') || '[]');
        let counters = {
            autoRingsScored: 0,
            autoMogos: 0,
            driverRingsScored: 0,
            driverMogos: 0
        };

        // Auto-backup every 30 seconds
        setInterval(() => {
            localStorage.setItem('vexScoutMatches', JSON.stringify(matches));
        }, 30000);

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateMatchCount();
            updateDataView();
            updateDataSummary();
            
            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js');
            }

            // Handle form submission
            document.getElementById('scoutForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitMatch();
            });

            // Hide install banner after first visit
            if (localStorage.getItem('vexScoutInstalled')) {
                document.getElementById('installBanner').style.display = 'none';
            }
        });

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');

            // Update data when switching to data or export tabs
            if (tabName === 'data') updateDataView();
            if (tabName === 'export') updateDataSummary();
        }

        function changeCounter(counterId, delta) {
            const currentValue = parseInt(document.getElementById(counterId).textContent);
            const newValue = Math.max(0, currentValue + delta);
            document.getElementById(counterId).textContent = newValue;
            counters[counterId] = newValue;
        }

        function validateTeamNumber(teamNumber) {
            const pattern = /^[0-9]+[A-Z]?$/;
            return pattern.test(teamNumber.trim());
        }

        function submitMatch() {
            const matchNumber = document.getElementById('matchNumber').value;
            const teamNumber = document.getElementById('teamNumber').value.trim();
            
            // Validate team number
            if (!validateTeamNumber(teamNumber)) {
                document.getElementById('teamNumber').classList.add('error');
                document.getElementById('teamError').style.display = 'block';
                return;
            } else {
                document.getElementById('teamNumber').classList.remove('error');
                document.getElementById('teamError').style.display = 'none';
            }

            const matchData = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                matchNumber: parseInt(matchNumber),
                teamNumber: teamNumber,
                autonomous: {
                    goalRush: document.querySelector('input[name="autoGoalRush"]:checked').value === 'yes',
                    ringsScored: counters.autoRingsScored,
                    mogosScored: counters.autoMogos
                },
                driverControl: {
                    ringsScored: counters.driverRingsScored,
                    mogosControlled: counters.driverMogos
                },
                endgame: document.querySelector('input[name="endgame"]:checked').value,
                notes: document.getElementById('notes').value.trim()
            };

            matches.push(matchData);
            localStorage.setItem('vexScoutMatches', JSON.stringify(matches));
            
            updateMatchCount();
            resetForm();
            
            // Show success message
            showSuccessMessage('Match data saved successfully!');
        }

        function resetForm() {
            document.getElementById('scoutForm').reset();
            
            // Reset counters
            Object.keys(counters).forEach(key => {
                counters[key] = 0;
                document.getElementById(key).textContent = '0';
            });
            
            // Reset radio buttons
            document.querySelector('input[name="autoGoalRush"][value="no"]').checked = true;
            document.querySelector('input[name="endgame"][value="none"]').checked = true;
        }

        function updateMatchCount() {
            document.getElementById('matchCount').textContent = matches.length;
        }

        function updateDataView() {
            const matchList = document.getElementById('matchList');
            
            if (matches.length === 0) {
                matchList.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 20px;">No matches recorded yet</p>';
                return;
            }

            matchList.innerHTML = matches.map(match => `
                <div class="match-item">
                    <button class="delete-match" onclick="deleteMatch(${match.id})">Ã—</button>
                    <div class="match-header">
                        <div class="match-title">Match ${match.matchNumber} - Team ${match.teamNumber}</div>
                    </div>
                    <div class="match-time">${new Date(match.timestamp).toLocaleString()}</div>
                    <div class="match-details">
                        <strong>Auto:</strong> ${match.autonomous.ringsScored} rings, ${match.autonomous.mogosScored} mogos${match.autonomous.goalRush ? ', Goal Rush' : ''}<br>
                        <strong>Driver:</strong> ${match.driverControl.ringsScored} rings, ${match.driverControl.mogosControlled} mogos<br>
                        <strong>Endgame:</strong> ${match.endgame}<br>
                        ${match.notes ? `<strong>Notes:</strong> ${match.notes}` : ''}
                    </div>
                </div>
            `).join('');
        }

        function deleteMatch(matchId) {
            if (confirm('Delete this match data?')) {
                matches = matches.filter(match => match.id !== matchId);
                localStorage.setItem('vexScoutMatches', JSON.stringify(matches));
                updateMatchCount();
                updateDataView();
                updateDataSummary();
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete all match data? This cannot be undone.')) {
                matches = [];
                localStorage.removeItem('vexScoutMatches');
                updateMatchCount();
                updateDataView();
                updateDataSummary();
                showSuccessMessage('All data cleared!');
            }
        }

        function exportToEmail() {
            const data = {
                exportDate: new Date().toISOString(),
                totalMatches: matches.length,
                matches: matches
            };
            
            const jsonData = JSON.stringify(data, null, 2);
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            const filename = `vex-scout-data-${timestamp}.json`;
            
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            
            URL.revokeObjectURL(url);
            
            showExportSuccess('Data exported successfully! Check your downloads folder.');
        }

        function copyToClipboard() {
            const data = {
                exportDate: new Date().toISOString(),
                totalMatches: matches.length,
                matches: matches
            };
            
            const jsonData = JSON.stringify(data, null, 2);
            
            navigator.clipboard.writeText(jsonData).then(() => {
                showExportSuccess('Data copied to clipboard! You can now paste it in any app.');
            }).catch(() => {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = jsonData;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showExportSuccess('Data copied to clipboard!');
            });
        }

        function updateDataSummary() {
            document.getElementById('totalMatches').textContent = matches.length;
            const lastUpdated = matches.length > 0 
                ? new Date(Math.max(...matches.map(m => new Date(m.timestamp)))).toLocaleString()
                : 'Never';
            document.getElementById('lastUpdated').textContent = lastUpdated;
        }

        function showSuccessMessage(message) {
            const existingMessage = document.querySelector('.success-message');
            if (existingMessage) existingMessage.remove();
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            
            document.querySelector('.tab-content.active').insertBefore(successDiv, document.querySelector('.tab-content.active').firstChild);
            
            setTimeout(() => successDiv.remove(), 3000);
        }

        function showExportSuccess(message) {
            const exportSuccess = document.getElementById('exportSuccess');
            exportSuccess.innerHTML = `<div class="success-message">${message}</div>`;
            exportSuccess.style.display = 'block';
            
            setTimeout(() => {
                exportSuccess.style.display = 'none';
            }, 5000);
        }

        // Hide install banner when installed
        window.addEventListener('beforeinstallprompt', (e) => {
            localStorage.setItem('vexScoutInstalled', 'true');
        });
    </script>
</body>
</html>