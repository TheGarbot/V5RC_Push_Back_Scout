<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2563eb">
    <title>VEX Scout</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="assets/icon-192.png">
    <link rel="apple-touch-icon" href="assets/icon-192.png">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>VEX Scout</h1>
            <div class="match-counter">
                Local: <span id="localCount">0</span> | 
                Synced: <span id="syncedCount">0</span>
            </div>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('scout')">Scout</button>
            <button class="nav-tab" onclick="switchTab('data')">Data</button>
            <button class="nav-tab" onclick="switchTab('sync')">Sync</button>
        </div>

        <div id="scout-tab" class="tab-content active">
            <div class="install-banner" id="installBanner">
                üì± <strong>Add to Home Screen</strong> for the best experience!<br>
                <div class="install-steps">
                    iOS: Share button ‚Üí "Add to Home Screen"<br>
                    Android: Menu ‚Üí "Add to Home Screen"
                </div>
            </div>

            <form id="scoutForm">
                <!-- BASIC INFO SECTION -->
                <div class="section-header">üìã Basic Information</div>
                
                <div class="form-group">
                    <label for="matchNumber">Match Number <span class="required">*</span></label>
                    <input type="number" id="matchNumber" required min="1">
                </div>

                <div class="form-group">
                    <label for="teamNumber">Team Number <span class="required">*</span></label>
                    <input type="text" id="teamNumber" required placeholder="e.g., 9123X" pattern="[0-9]+[A-Z]?">
                    <div class="error-message" id="teamError" style="display: none;">Invalid team format (use format like 9123X)</div>
                </div>

                <div class="form-group">
                    <label for="alliance">Alliance Color</label>
                    <select id="alliance">
                        <option value="red">Red</option>
                        <option value="blue">Blue</option>
                    </select>
                </div>

                <!-- AUTONOMOUS SECTION - EASY TO MODIFY -->
                <div class="section-header">ü§ñ Autonomous Period (15 seconds)</div>
                
                <!-- RADIO BUTTON METRIC - Copy this pattern for yes/no questions -->
                <div class="form-group">
                    <label>Goal Rush Bonus</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="autoGoalRush" value="yes"> Yes
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="autoGoalRush" value="no" checked> No
                        </label>
                    </div>
                </div>

                <!-- COUNTER METRIC - Copy this pattern for counting things -->
                <div class="form-group">
                    <label>Rings Scored in Mobile Goals</label>
                    <div class="counter-group">
                        <button type="button" class="counter-btn" onclick="changeCounter('autoRingsScored', -1)">-</button>
                        <div class="counter-value" id="autoRingsScored">0</div>
                        <button type="button" class="counter-btn" onclick="changeCounter('autoRingsScored', 1)">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Mobile Goals Scored</label>
                    <div class="counter-group">
                        <button type="button" class="counter-btn" onclick="changeCounter('autoMogos', -1)">-</button>
                        <div class="counter-value" id="autoMogos">0</div>
                        <button type="button" class="counter-btn" onclick="changeCounter('autoMogos', 1)">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Rings Scored in Corner</label>
                    <div class="counter-group">
                        <button type="button" class="counter-btn" onclick="changeCounter('autoCornerRings', -1)">-</button>
                        <div class="counter-value" id="autoCornerRings">0</div>
                        <button type="button" class="counter-btn" onclick="changeCounter('autoCornerRings', 1)">+</button>
                    </div>
                </div>

                <!-- DRIVER CONTROL SECTION - EASY TO MODIFY -->
                <div class="section-header">üïπÔ∏è Driver Control Period (1:45)</div>
                
                <div class="form-group">
                    <label>Rings Scored in Mobile Goals</label>
                    <div class="counter-group">
                        <button type="button" class="counter-btn" onclick="changeCounter('driverRingsScored', -1)">-</button>
                        <div class="counter-value" id="driverRingsScored">0</div>
                        <button type="button" class="counter-btn" onclick="changeCounter('driverRingsScored', 1)">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Mobile Goals Controlled</label>
                    <div class="counter-group">
                        <button type="button" class="counter-btn" onclick="changeCounter('driverMogos', -1)">-</button>
                        <div class="counter-value" id="driverMogos">0</div>
                        <button type="button" class="counter-btn" onclick="changeCounter('driverMogos', 1)">+</button>
                    </div>
                </div>

                <div class="form-group">
                    <label>Rings Scored in Corner</label>
                    <div class="counter-group">
                        <button type="button" class="counter-btn" onclick="changeCounter('driverCornerRings', -1)">-</button>
                        <div class="counter-value" id="driverCornerRings">0</div>
                        <button type="button" class="counter-btn" onclick="changeCounter('driverCornerRings', 1)">+</button>
                    </div>
                </div>

                <!-- DROPDOWN METRIC - Copy this pattern for multiple choice -->
                <div class="form-group">
                    <label>Robot Speed/Agility</label>
                    <select id="robotSpeed">
                        <option value="slow">Slow</option>
                        <option value="average" selected>Average</option>
                        <option value="fast">Fast</option>
                        <option value="very-fast">Very Fast</option>
                    </select>
                </div>

                <!-- ENDGAME SECTION -->
                <div class="section-header">‚è∞ Endgame (Last 30 seconds)</div>
                
                <div class="form-group">
                    <label>Climb Status</label>
                    <div class="radio-group">
                        <label class="radio-option">
                            <input type="radio" name="endgame" value="none" checked> None
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="endgame" value="attempted"> Attempted
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="endgame" value="single"> Single Climb
                        </label>
                        <label class="radio-option">
                            <input type="radio" name="endgame" value="double"> Double Climb
                        </label>
                    </div>
                </div>

                <!-- QUALITATIVE SECTION -->
                <div class="section-header">üìù Qualitative Assessment</div>
                
                <div class="form-group">
                    <label>Defense Rating</label>
                    <select id="defenseRating">
                        <option value="none">No Defense</option>
                        <option value="weak">Weak Defense</option>
                        <option value="average" selected>Average Defense</option>
                        <option value="strong">Strong Defense</option>
                        <option value="excellent">Excellent Defense</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Driver Skill</label>
                    <select id="driverSkill">
                        <option value="poor">Poor</option>
                        <option value="below-average">Below Average</option>
                        <option value="average" selected>Average</option>
                        <option value="above-average">Above Average</option>
                        <option value="excellent">Excellent</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>Reliability Issues</label>
                    <div class="checkbox-group">
                        <label class="checkbox-option">
                            <input type="checkbox" id="brokeDown"> Broke Down
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" id="tippedOver"> Tipped Over
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" id="stuckOnField"> Got Stuck
                        </label>
                        <label class="checkbox-option">
                            <input type="checkbox" id="slowRepairs"> Needed Repairs
                        </label>
                    </div>
                </div>

                <div class="form-group">
                    <label>Additional Notes</label>
                    <textarea id="notes" placeholder="Strategy, special moves, partnership notes..."></textarea>
                </div>

                <button type="submit" class="btn btn-primary">üíæ Save Match Data</button>
                <button type="button" class="btn btn-secondary" onclick="resetForm()">üîÑ Clear Form</button>
            </form>
        </div>

        <div id="data-tab" class="tab-content">
            <div class="data-summary">
                <h3>üìä Local Data</h3>
                <div class="summary-stats">
                    <div class="stat-item">
                        <span class="stat-number" id="totalLocalMatches">0</span>
                        <span class="stat-label">Total Matches</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number" id="unsyncedMatches">0</span>
                        <span class="stat-label">Unsynced</span>
                    </div>
                </div>
            </div>
            
            <div id="matchList" class="match-list">
                <p style="text-align: center; color: #6b7280; padding: 20px;">No matches recorded yet</p>
            </div>
            
            <div class="data-actions">
                <button class="btn btn-danger" onclick="clearAllData()">üóëÔ∏è Clear All Local Data</button>
            </div>
        </div>

        <div id="sync-tab" class="tab-content">
            <div id="syncSuccess" style="display: none;"></div>
            
            <div class="sync-status">
                <h3>üì° Sync to Laptop</h3>
                <div class="status-indicator" id="syncStatus">
                    <div class="status-dot offline"></div>
                    <span>Not Connected</span>
                </div>
            </div>

            <div class="sync-settings">
                <div class="form-group">
                    <label for="laptopIP">Laptop IP Address</label>
                    <input type="text" id="laptopIP" placeholder="192.168.1.100" value="">
                    <div class="help-text">Find your laptop's IP address and enter it here</div>
                </div>
                
                <div class="form-group">
                    <label for="syncPort">Port (Optional)</label>
                    <input type="number" id="syncPort" placeholder="3000" value="3000">
                </div>
            </div>

            <div class="sync-actions">
                <button class="btn btn-primary" onclick="testConnection()">üîç Test Connection</button>
                <button class="btn btn-success" onclick="syncToLaptop()" id="syncButton" disabled>
                    üì§ Sync All Data (<span id="pendingCount">0</span> matches)
                </button>
                <button class="btn btn-secondary" onclick="exportBackup()">üíæ Download Backup</button>
            </div>

            <div class="sync-log" id="syncLog" style="display: none;">
                <h4>üìú Sync Log</h4>
                <div class="log-content" id="logContent"></div>
            </div>

            <div class="sync-help">
                <h4>‚ùì How to Setup Sync</h4>
                <ol>
                    <li>On your laptop, find your IP address:
                        <ul>
                            <li><strong>Windows:</strong> Open Command Prompt, type <code>ipconfig</code></li>
                            <li><strong>Mac:</strong> System Preferences ‚Üí Network</li>
                            <li><strong>Linux:</strong> Terminal, type <code>ip addr</code></li>
                        </ul>
                    </li>
                    <li>Enter the IP address above</li>
                    <li>Click "Test Connection"</li>
                    <li>Once connected, "Sync All Data" will be enabled</li>
                </ol>
                <p><strong>Note:</strong> Make sure your laptop and phone are on the same WiFi network!</p>
            </div>
        </div>
    </div>

    <script>
        // =============================================================================
        // CONFIGURATION - Easy to modify counters and data structure
        // =============================================================================
        
        // Add/remove counter IDs here to automatically initialize them
        const COUNTER_IDS = [
            'autoRingsScored',
            'autoMogos', 
            'autoCornerRings',
            'driverRingsScored',
            'driverMogos',
            'driverCornerRings'
        ];

        // Global variables
        let matches = JSON.parse(localStorage.getItem('vexScoutMatches') || '[]');
        let syncedMatches = JSON.parse(localStorage.getItem('vexScoutSyncedMatches') || '[]');
        let counters = {};
        
        // Initialize all counters to 0
        COUNTER_IDS.forEach(id => {
            counters[id] = 0;
        });

        // =============================================================================
        // CORE APP FUNCTIONS
        // =============================================================================

        // Auto-backup every 30 seconds
        setInterval(() => {
            localStorage.setItem('vexScoutMatches', JSON.stringify(matches));
            localStorage.setItem('vexScoutSyncedMatches', JSON.stringify(syncedMatches));
        }, 30000);

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            updateMatchCounts();
            updateDataView();
            loadSyncSettings();
            
            // Register service worker
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('sw.js');
            }

            // Handle form submission
            document.getElementById('scoutForm').addEventListener('submit', function(e) {
                e.preventDefault();
                submitMatch();
            });

            // Hide install banner after first visit
            if (localStorage.getItem('vexScoutInstalled')) {
                document.getElementById('installBanner').style.display = 'none';
            }

            // Save sync settings when changed
            document.getElementById('laptopIP').addEventListener('change', saveSyncSettings);
            document.getElementById('syncPort').addEventListener('change', saveSyncSettings);
        });

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');

            // Update data when switching tabs
            if (tabName === 'data') updateDataView();
            if (tabName === 'sync') updateSyncTab();
        }

        function changeCounter(counterId, delta) {
            const currentValue = parseInt(document.getElementById(counterId).textContent);
            const newValue = Math.max(0, currentValue + delta);
            document.getElementById(counterId).textContent = newValue;
            counters[counterId] = newValue;
        }

        function validateTeamNumber(teamNumber) {
            const pattern = /^[0-9]+[A-Z]?$/;
            return pattern.test(teamNumber.trim());
        }

        function submitMatch() {
            const matchNumber = document.getElementById('matchNumber').value;
            const teamNumber = document.getElementById('teamNumber').value.trim();
            
            // Validate team number
            if (!validateTeamNumber(teamNumber)) {
                document.getElementById('teamNumber').classList.add('error');
                document.getElementById('teamError').style.display = 'block';
                return;
            } else {
                document.getElementById('teamNumber').classList.remove('error');
                document.getElementById('teamError').style.display = 'none';
            }

            // Collect all form data automatically
            const matchData = {
                id: Date.now(),
                timestamp: new Date().toISOString(),
                synced: false,
                
                // Basic info
                matchNumber: parseInt(matchNumber),
                teamNumber: teamNumber,
                alliance: document.getElementById('alliance').value,
                
                // Autonomous data
                autonomous: {
                    goalRush: document.querySelector('input[name="autoGoalRush"]:checked').value === 'yes',
                    ringsScored: counters.autoRingsScored,
                    mogosScored: counters.autoMogos,
                    cornerRings: counters.autoCornerRings
                },
                
                // Driver control data  
                driverControl: {
                    ringsScored: counters.driverRingsScored,
                    mogosControlled: counters.driverMogos,
                    cornerRings: counters.driverCornerRings,
                    robotSpeed: document.getElementById('robotSpeed').value
                },
                
                // Endgame
                endgame: document.querySelector('input[name="endgame"]:checked').value,
                
                // Qualitative
                qualitative: {
                    defenseRating: document.getElementById('defenseRating').value,
                    driverSkill: document.getElementById('driverSkill').value,
                    reliability: {
                        brokeDown: document.getElementById('brokeDown').checked,
                        tippedOver: document.getElementById('tippedOver').checked,
                        stuckOnField: document.getElementById('stuckOnField').checked,
                        slowRepairs: document.getElementById('slowRepairs').checked
                    }
                },
                
                // Notes
                notes: document.getElementById('notes').value.trim()
            };

            matches.push(matchData);
            localStorage.setItem('vexScoutMatches', JSON.stringify(matches));
            
            updateMatchCounts();
            resetForm();
            
            // Show success message
            showSuccessMessage('Match data saved locally! üì±');
        }

        function resetForm() {
            document.getElementById('scoutForm').reset();
            
            // Reset counters
            COUNTER_IDS.forEach(id => {
                counters[id] = 0;
                document.getElementById(id).textContent = '0';
            });
            
            // Reset radio buttons to defaults
            document.querySelector('input[name="autoGoalRush"][value="no"]').checked = true;
            document.querySelector('input[name="endgame"][value="none"]').checked = true;
            
            // Reset checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            // Reset dropdowns to default
            document.getElementById('alliance').selectedIndex = 0;
            document.getElementById('robotSpeed').value = 'average';
            document.getElementById('defenseRating').value = 'average';
            document.getElementById('driverSkill').value = 'average';
        }

        function updateMatchCounts() {
            const unsyncedCount = matches.filter(m => !m.synced).length;
            document.getElementById('localCount').textContent = matches.length;
            document.getElementById('syncedCount').textContent = syncedMatches.length;
            document.getElementById('totalLocalMatches').textContent = matches.length;
            document.getElementById('unsyncedMatches').textContent = unsyncedCount;
            document.getElementById('pendingCount').textContent = unsyncedCount;
        }

        function updateDataView() {
            const matchList = document.getElementById('matchList');
            
            if (matches.length === 0) {
                matchList.innerHTML = '<p style="text-align: center; color: #6b7280; padding: 20px;">No matches recorded yet</p>';
                return;
            }

            matchList.innerHTML = matches.map(match => `
                <div class="match-item ${match.synced ? 'synced' : 'unsynced'}">
                    <div class="sync-indicator">
                        ${match.synced ? '‚úÖ' : '‚è≥'}
                    </div>
                    <button class="delete-match" onclick="deleteMatch(${match.id})">√ó</button>
                    <div class="match-header">
                        <div class="match-title">Match ${match.matchNumber} - Team ${match.teamNumber} (${match.alliance})</div>
                    </div>
                    <div class="match-time">${new Date(match.timestamp).toLocaleString()}</div>
                    <div class="match-details">
                        <strong>Auto:</strong> ${match.autonomous.ringsScored} rings, ${match.autonomous.mogosScored} mogos${match.autonomous.goalRush ? ', Goal Rush' : ''}<br>
                        <strong>Driver:</strong> ${match.driverControl.ringsScored} rings, ${match.driverControl.mogosControlled} mogos<br>
                        <strong>Endgame:</strong> ${match.endgame}<br>
                        <strong>Driver Skill:</strong> ${match.qualitative.driverSkill}<br>
                        ${match.notes ? `<strong>Notes:</strong> ${match.notes}` : ''}
                    </div>
                </div>
            `).join('');
        }

        function deleteMatch(matchId) {
            if (confirm('Delete this match data?')) {
                matches = matches.filter(match => match.id !== matchId);
                localStorage.setItem('vexScoutMatches', JSON.stringify(matches));
                updateMatchCounts();
                updateDataView();
            }
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete all local match data? This cannot be undone.')) {
                matches = [];
                localStorage.removeItem('vexScoutMatches');
                updateMatchCounts();
                updateDataView();
                showSuccessMessage('All local data cleared! üóëÔ∏è');
            }
        }

        // =============================================================================
        // SYNC FUNCTIONS - Connect to your laptop
        // =============================================================================

        function saveSyncSettings() {
            const settings = {
                laptopIP: document.getElementById('laptopIP').value,
                syncPort: document.getElementById('syncPort').value
            };
            localStorage.setItem('vexScoutSyncSettings', JSON.stringify(settings));
        }

        function loadSyncSettings() {
            const settings = JSON.parse(localStorage.getItem('vexScoutSyncSettings') || '{}');
            if (settings.laptopIP) document.getElementById('laptopIP').value = settings.laptopIP;
            if (settings.syncPort) document.getElementById('syncPort').value = settings.syncPort;
        }

        function updateSyncTab() {
            updateMatchCounts();
            updateSyncStatus();
        }

        function updateSyncStatus() {
            const statusIndicator = document.getElementById('syncStatus');
            const statusDot = statusIndicator.querySelector('.status-dot');
            const statusText = statusIndicator.querySelector('span');
            
            // For now, always show offline - you'll implement the actual connection test
            statusDot.className = 'status-dot offline';
            statusText.textContent = 'Not Connected';
        }

       // Replace your existing testConnection function with this:
async function testConnection() {
    const testButton = document.getElementById('testButton');
    const syncLog = document.getElementById('syncLog');
    const ipAddress = document.getElementById('laptopIP').value.trim();
    
    if (!ipAddress) {
        addToSyncLog('‚ùå Please enter laptop IP address');
        return;
    }
    
    testButton.disabled = true;
    testButton.textContent = 'Testing...';
    
    try {
        addToSyncLog('üîç Testing connection...');
        
        const response = await fetch(`http://${ipAddress}:3000/api/test`, {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        if (response.ok) {
            const result = await response.json();
            addToSyncLog('‚úÖ Connection successful! Server is reachable.');
        } else {
            throw new Error(`Server responded with status: ${response.status}`);
        }
        
    } catch (error) {
        console.error('Connection test error:', error);
        addToSyncLog(`‚ùå Connection failed: ${error.message}`);
        addToSyncLog('Make sure the server is running on your laptop and you\'re on the same network.');
    } finally {
        testButton.disabled = false;
        testButton.textContent = 'Test Connection';
    }
}

// Replace your existing syncToLaptop function with this:
async function syncToLaptop() {
    
    const syncButton = document.getElementById('syncButton');
    const syncLog = document.getElementById('syncLog');
    const ipAddress = document.getElementById('laptopIP').value.trim();
    
    if (!ipAddress) {
        addToSyncLog('‚ùå Please enter laptop IP address');
        return;
    }
    
    syncButton.disabled = true;
    syncButton.textContent = 'Syncing...';
    
    try {
        // Get unsynced matches
        const matches = JSON.parse(localStorage.getItem('vexScoutMatches') || '[]');
        const unsyncedMatches = matches.filter(match => !match.synced);
        
        if (unsyncedMatches.length === 0) {
            addToSyncLog('‚úÖ No unsynced data found');
            return;
        }
        
        addToSyncLog(`üì§ Sending ${unsyncedMatches.length} matches...`);
        
        // Send data to laptop
        const response = await fetch(`http://${ipAddress}:3000/api/matches`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                matches: unsyncedMatches,
                deviceInfo: {
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent
                }
            })
        });
        
        if (response.ok) {
            const result = await response.json();
            
            // Mark matches as synced
            matches.forEach(match => {
                if (!match.synced && unsyncedMatches.some(um => um.id === match.id)) {
                    match.synced = true;
                    match.syncedAt = new Date().toISOString();
                }
            });
            
            // Save updated data
            localStorage.setItem('vexScoutMatches', JSON.stringify(matches));
            
            // Update display
            displayMatches();
            updateSyncTab();
            
            addToSyncLog(`‚úÖ Successfully synced ${unsyncedMatches.length} matches!`);
        } else {
            throw new Error(`Server responded with status: ${response.status}`);
        }
        
    } catch (error) {
        console.error('Sync error:', error);
        addToSyncLog(`‚ùå Sync failed: ${error.message}`);
    } finally {
        syncButton.disabled = false;
        syncButton.textContent = 'Sync to Laptop';
    }
}



// Replace your existing syncToLaptop function with this:
async function syncToLaptop() {
    const syncButton = document.getElementById('syncButton');
    const syncLog = document.getElementById('syncLog');
    const ipAddress = document.getElementById('laptopIP').value.trim();
    
    if (!ipAddress) {
        addToSyncLog('‚ùå Please enter laptop IP address');
        return;
    }
    
    syncButton.disabled = true;
    syncButton.textContent = 'Syncing...';
    
    try {
        // Get unsynced matches
        const matches = JSON.parse(localStorage.getItem('scoutData') || '[]');
        const unsyncedMatches = matches.filter(match => !match.synced);
        
        if (unsyncedMatches.length === 0) {
            addToSyncLog('‚úÖ No unsynced data found');
            return;
        }
        
        addToSyncLog(`üì§ Sending ${unsyncedMatches.length} matches...`);
        
        // Send data to laptop
        const response = await fetch(`http://${ipAddress}:3000/api/matches`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                matches: unsyncedMatches,
                deviceInfo: {
                    timestamp: new Date().toISOString(),
                    userAgent: navigator.userAgent
                }
            })
        });
        
        if (response.ok) {
            const result = await response.json();
            
            // Mark matches as synced
            matches.forEach(match => {
                if (!match.synced && unsyncedMatches.some(um => um.id === match.id)) {
                    match.synced = true;
                    match.syncedAt = new Date().toISOString();
                }
            });
            
            // Save updated data
            localStorage.setItem('scoutData', JSON.stringify(matches));
            
            // Update display
            updateDataView();
            updateSyncTab();
            
            addToSyncLog(`‚úÖ Successfully synced ${unsyncedMatches.length} matches!`);
        } else {
            throw new Error(`Server responded with status: ${response.status}`);
        }
        
    } catch (error) {
        console.error('Sync error:', error);
        addToSyncLog(`‚ùå Sync failed: ${error.message}`);
    } finally {
        syncButton.disabled = false;
        syncButton.textContent = 'Sync to Laptop';
    }
}   

        function exportBackup() {
            const data = {
                exportDate: new Date().toISOString(),
                totalMatches: matches.length,
                syncedMatches: syncedMatches.length,
                matches: matches,
                syncedMatchesData: syncedMatches
            };
            
            const jsonData = JSON.stringify(data, null, 2);
            const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, '-');
            const filename = `vex-scout-backup-${timestamp}.json`;
            
            const blob = new Blob([jsonData], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.click();
            
            URL.revokeObjectURL(url);
            addToSyncLog('üíæ Backup downloaded: ' + filename);
        }

        function addToSyncLog(message) {
            const logContent = document.getElementById('logContent');
            const syncLog = document.getElementById('syncLog');
            
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            logEntry.innerHTML = `<span class="log-time">[${timestamp}]</span> ${message}`;
            
            logContent.appendChild(logEntry);
            syncLog.style.display = 'block';
            
            // Scroll to bottom
            logContent.scrollTop = logContent.scrollHeight;
        }

        // =============================================================================
        // UTILITY FUNCTIONS
        // =============================================================================

        function showSuccessMessage(message) {
            const existingMessage = document.querySelector('.success-message');
            if (existingMessage) existingMessage.remove();
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            
            document.querySelector('.tab-content.active').insertBefore(successDiv, document.querySelector('.tab-content.active').firstChild);
            
            setTimeout(() => successDiv.remove(), 3000);
        }

        function showSyncSuccess(message) {
            const syncSuccess = document.getElementById('syncSuccess');
            syncSuccess.innerHTML = `<div class="success-message">${message}</div>`;
            syncSuccess.style.display = 'block';
            
            setTimeout(() => {
                syncSuccess.style.display = 'none';
            }, 5000);
        }

        // Hide install banner when installed
        window.addEventListener('beforeinstallprompt', (e) => {
            localStorage.setItem('vexScoutInstalled', 'true');
        });
    </script>
</body>
</html>